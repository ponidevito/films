function togglePasswordVisibility(){let e=document.querySelector(".modal__checkbox");var t=document.getElementById("password"),o=document.getElementById("showPassword");o.checked=!o.checked,o.checked?(e.classList.add("changeColor"),t.type="text"):(e.classList.remove("changeColor"),t.type="password")}let db,counter=1;function handleDeleteButtonClick(e){const t=e.target.dataset.id;confirm("Ви впевнені, що хочете видалити цей фільм?")&&deleteFilm(t)}function formatDate(e){return new Date(1e3*e.seconds).toLocaleDateString("uk-UA")}if(document.addEventListener("DOMContentLoaded",(async function(){if("Collection"===document.title){const e={apiKey:"AIzaSyCL7wAwDtfMIDshLv4_aZLD0QXbC_BEBFo",authDomain:"cinema-collection-ce9ba.firebaseapp.com",projectId:"cinema-collection-ce9ba",storageBucket:"cinema-collection-ce9ba.appspot.com",messagingSenderId:"597377281566",appId:"1:597377281566:web:c49563737b63b6c131080f"};try{firebase.initializeApp(e)}catch(e){console.error("Помилка при ініціалізації Firebase:",e)}const t=firebase.firestore(),o=document.getElementById("filmCollection");firebase.auth().onAuthStateChanged((async function(e){if(e){const n=e.uid,a=await checkIfUserIsAdmin(e);try{(await t.collection("films").where("authorUid","==",n).get()).forEach((e=>{const t=e.data();if(a||n&&n===t.authorUid){const n=document.createElement("a");n.className="collection__column",n.href=`details.html?id=${e.id}`,n.innerHTML=`\n                <div class="collection__picture"><img class="collection__poster" src="${t.imageURL}" alt="Film Poster"></div>\n                <div class="collection__about">\n                  <h2 class="collection__name">${t.title}</h2>\n                </div>\n              `,o?o.appendChild(n):console.error("Елемент #filmCollection не знайдено.")}}))}catch(e){console.error("Помилка при отриманні фільмів з Firebase:",e)}}else window.location.pathname.includes("index.html")||(console.log("Направляю неавторизованого користувача на index.html"),window.location.href="index.html")}))}if("cabinet"===document.title){const e=document.querySelector(".admin-cabinet__table tbody");db=firebase.firestore(),firebase.auth().onAuthStateChanged((async function(t){if(t){const o=await checkIfUserIsAdmin(t);try{if(o){const t=await db.collection("films").get();e.innerHTML="",t.forEach((async t=>{const o=t.data(),n=await db.collection("users").doc(o.authorUid).get(),a=n.exists?n.data():{},c=document.createElement("tr");c.innerHTML=`\n                <td>${counter}</td>\n                <td>${a.firstName}</td>\n                <td><p>${o.title}</p></td>\n                <td>${o.time}, ${o.date}</td>\n                <td>\n                  <button class="admin-cabinet__button-delete delete-button link" data-id="${t.id}" onclick="deleteFilm('${t.id}')">Видалити</button>\n                </td>\n              `,e.appendChild(c),counter++}));document.querySelectorAll(".delete-button").forEach((e=>{e.addEventListener("click",handleDeleteButtonClick)}))}else{const o=await db.collection("films").where("authorUid","==",t.uid).get(),n=await db.collection("users").doc(t.uid).get(),a=n.exists?n.data():{};console.log(a),e.innerHTML="",o.forEach((t=>{const o=t.data(),n=document.createElement("tr");n.innerHTML=`\n                <td>${counter}</td>\n                <td>${a.firstName}</td>\n                <td>${o.title}</td>\n                <td>${o.time}, ${o.date}</td>\n                <td>\n                  <button class="admin-cabinet__button-delete delete-button link" data-id="${t.id}" onclick="deleteFilm('${t.id}')">Видалити</button>\n                </td>\n              `,e.appendChild(n),counter++}));document.querySelectorAll(".delete-button").forEach((e=>{e.addEventListener("click",handleDeleteButtonClick)}))}}catch(e){console.error("Помилка при отриманні фільмів з Firebase:",e)}}}))}})),document.addEventListener("DOMContentLoaded",(async function(){window.deleteFilm=async function(e){try{if(!db)return void console.error("Помилка: db не ініціалізовано.");await db.collection("films").doc(e).delete(),console.log("Фільм видалено успішно!");const t=document.querySelector(`[data-id="${e}"]`);t?(t.parentElement.parentElement.remove(),console.log("Лічильник після видалення:",counter)):console.warn(`Елемент з data-id=${e} не знайдено для видалення.`);document.querySelectorAll(".admin-cabinet__table tbody tr").forEach(((e,t)=>{const o=e.querySelector("td:first-child");o&&(o.textContent=t+1)}))}catch(e){console.error("Помилка при видаленні фільму:",e)}}})),"Додати фільм"===document.title){const e={apiKey:"AIzaSyCL7wAwDtfMIDshLv4_aZLD0QXbC_BEBFo",authDomain:"cinema-collection-ce9ba.firebaseapp.com",projectId:"cinema-collection-ce9ba",storageBucket:"cinema-collection-ce9ba.appspot.com",messagingSenderId:"597377281566",appId:"1:597377281566:web:c49563737b63b6c131080f"};firebase.initializeApp(e);const t=firebase.firestore(),o=document.querySelector(".form"),n=document.querySelector("#imageInput");async function uploadImage(e){try{const n=firebase.storage().ref().child("images/"+e.name),a=(await n.put(e),await n.getDownloadURL()),c=localStorage.getItem("userId"),l=new Date,i=l.getHours().toString().padStart(2,"0"),r=l.getMinutes().toString().padStart(2,"0"),d=l.getFullYear().toString().slice(-2),s=(l.getMonth()+1).toString().padStart(2,"0"),m=l.getDate().toString().padStart(2,"0"),u=`${i}.${r}`,h=`${s}/${m}/${d}`,g=o.querySelector("input[placeholder='Назва']").value;if(!(await t.collection("films").where("title","==",g).get()).empty)return void console.error("Фільм з такою назвою вже існує.");console.log("Файл успішно завантажено!");const f=await t.collection("films").add({title:g,time:u,date:h,year:o.querySelector("input[placeholder='Рік']").value,description:o.querySelector("input[placeholder='Про фільм']").value,youtubeURL:o.querySelector("input[name='youtube']").value,imageURL:a,authorUid:c});await f.update({id:f.id}),console.log("Документ успішно додано з ID:",f.id)}catch(e){console.error("Виникла помилка при обробці:",e)}}o.addEventListener("submit",(function(e){e.preventDefault();uploadImage(n.files[0],o)}))}function bindModal(e,t,o){e=document.querySelector(e),t=document.querySelector(t),o=document.querySelector(o);const n=document.body;e.addEventListener("click",(e=>{e.preventDefault(),t.style.display="flex",n.classList.add("locked")})),o.addEventListener("click",(()=>{t.style.display="none",n.classList.remove("locked")})),t.addEventListener("click",(e=>{e.target===t&&(t.style.display="none",n.classList.remove("locked"))}))}bindModal(".modal__btn",".modal__wrapper",".modal__close");let searchBox=document.querySelector(".header__box"),modalLogin=document.querySelector(".modal__wrapper"),userEnter=document.querySelector(".header__user"),loginBox=document.querySelector(".header__login-box");function submitForm(){let e=document.getElementById("loginForm").elements.email.value,t=document.getElementById("loginForm").elements.password.value;firebase.auth().signInWithEmailAndPassword(e,t).then((e=>{let t=e.user;firebase.firestore().collection("users").doc(t.uid).get().then((e=>{if(e.exists){const o=e.data().role;localStorage.setItem("userRole",o),localStorage.setItem("userId",t.uid),localStorage.setItem("userEmail",t.email),localStorage.setItem("userName",e.data().firstName),searchBox.classList.add("show"),modalLogin.classList.add("hide"),userEnter.classList.add("hide"),loginBox.classList.add("show-box"),console.log(o),console.log("Успішний вхід:",t)}else console.error("Документ користувача не існує!")}))})).catch((e=>{var t=e.code,o=e.message;console.error("Помилка входу:",t,o)}))}function logOut(){localStorage.removeItem("userId"),localStorage.removeItem("userEmail"),localStorage.removeItem("userRole"),localStorage.removeItem("userName"),searchBox.classList.remove("show"),modalLogin.classList.remove("hide"),userEnter.classList.remove("hide"),loginBox.classList.remove("show-box"),console.log("Користувач вийшов."),window.location.href="/index.html"}async function checkIfUserIsAdmin(e){if(!e){return"admin"===localStorage.getItem("userRole")}try{const t=firebase.firestore().collection("users").doc(e.uid),o=await t.get();if(o.exists){return"admin"===o.data().role}return console.error("Документ користувача не існує!"),!1}catch(e){return console.error("Помилка при отриманні ролі користувача:",e),!1}}document.addEventListener("DOMContentLoaded",(async function(){const e=document.getElementById("filmCollection");firebase.auth().onAuthStateChanged((async function(t){if(t){await checkIfUserIsAdmin(t);if(e)try{(await firebase.firestore().collection("films").get()).forEach((e=>{e.data()}))}catch(e){console.error("Помилка при отриманні фільмів з Firebase:",e)}}else window.location.pathname.includes("index.html")||(console.log("Направляю неавторизованого користувача на index.html"),window.location.href="index.html")}))}));let userId=localStorage.getItem("userId"),userEmail=localStorage.getItem("userEmail");userId&&userEmail?(searchBox.classList.add("show"),modalLogin.classList.add("hide"),userEnter.classList.add("hide"),loginBox.classList.add("show-box"),console.log("Користувач увійшов. ID:",userId,"Email:",userEmail)):window.location.pathname.includes("index.html")?console.log("Користувач не увійшов. Покажіть стандартний інтерфейс або виконайте інші дії."):(console.log("Направляю неавторизованого користувача на index.html"),window.location.href="/index.html"),"Інформація про фільм"===document.title&&document.addEventListener("DOMContentLoaded",(function(){const e=new URLSearchParams(window.location.search),t=String(e.get("id")),o=document.getElementById("moviePoster"),n=document.getElementById("movieTrailer"),a=document.getElementById("releaseYearLabel"),c=document.getElementById("releaseYearValue"),l=document.getElementById("movieDescrLabel"),i=document.getElementById("movieDescrValue");console.log("movieId:",t);firebase.firestore().collection("films").doc(t).get().then((e=>{if(e.exists){const t=e.data();o.src=t.imageURL,document.getElementById("movieTitle").innerText=t.title,a.innerText="Рік виходу: ",c.innerText=t.year,l.innerText="Опис: ",i.innerText=t.description,n.src=t.youtubeURL}else console.error("No such document!")})).catch((e=>console.error("Error fetching movie details:",e)))})),document.addEventListener("DOMContentLoaded",(function(){["collection-films.html","інша-захищена-сторінка.html"].includes(window.location.pathname)&&!checkAuth()&&(console.log("Користувач не увійшов. Перенаправлення на сторінку авторизації."),window.location.href="/index.html")}));