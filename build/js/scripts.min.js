function togglePasswordVisibility(){let e=document.querySelector(".modal__checkbox");var o=document.getElementById("password"),t=document.getElementById("showPassword");t.checked=!t.checked,t.checked?(e.classList.add("changeColor"),o.type="text"):(e.classList.remove("changeColor"),o.type="password")}if(document.addEventListener("DOMContentLoaded",(async function(){if("Collection"===document.title){const e={apiKey:"AIzaSyCL7wAwDtfMIDshLv4_aZLD0QXbC_BEBFo",authDomain:"cinema-collection-ce9ba.firebaseapp.com",projectId:"cinema-collection-ce9ba",storageBucket:"cinema-collection-ce9ba.appspot.com",messagingSenderId:"597377281566",appId:"1:597377281566:web:c49563737b63b6c131080f"};firebase.initializeApp(e);const o=firebase.firestore(),t=document.getElementById("filmCollection");firebase.auth().onAuthStateChanged((async function(e){if(e){const n=await checkIfUserIsAdmin(e);try{(await o.collection("films").get()).forEach((e=>{const o=e.data();if(console.log("userId from localStorage:",userId),console.log("authorUid from filmData:",o.authorUid),n||userId&&userId===o.authorUid){const n=document.createElement("a");n.className="collection__column",n.href=`details.html?id=${e.id}`,n.innerHTML=`\n                <div class="collection__picture"><img class="collection__poster" src="${o.imageURL}" alt="Film Poster"></div>\n                <div class="collection__about">\n                  <h2 class="collection__name">${o.title}</h2>\n                  <p>Added by: ${o.authorUid}</p>\n                </div>\n              `,t.appendChild(n)}}))}catch(e){console.error("Помилка при отриманні фільмів з Firebase:",e)}}else window.location.pathname.includes("index.html")||(console.log("Направляю неавторизованого користувача на index.html"),window.location.href="index.html")}))}})),"Додати фільм"===document.title){const e={apiKey:"AIzaSyCL7wAwDtfMIDshLv4_aZLD0QXbC_BEBFo",authDomain:"cinema-collection-ce9ba.firebaseapp.com",projectId:"cinema-collection-ce9ba",storageBucket:"cinema-collection-ce9ba.appspot.com",messagingSenderId:"597377281566",appId:"1:597377281566:web:c49563737b63b6c131080f"};firebase.initializeApp(e);const o=firebase.firestore(),t=document.querySelector(".form"),n=document.querySelector("#imageInput");function uploadImage(e){const n=firebase.storage().ref().child("images/"+e.name);n.put(e).then((e=>{console.log("Файл успішно завантажено!"),n.getDownloadURL().then((e=>{localStorage.getItem("userId");o.collection("films").add({title:t.querySelector("input[placeholder='Назва']").value,year:t.querySelector("input[placeholder='Рік']").value,description:t.querySelector("input[placeholder='Про фільм']").value,youtubeURL:t.querySelector("input[name='youtube']").value,imageURL:e,authorUid:localStorage.getItem("userId")}).then((e=>{e.update({id:e.id}).then((()=>{console.log("Документ успішно додано з ID:",e.id)})).catch((e=>{console.error("Помилка при оновленні ID:",e)}))})).catch((e=>{console.error("Помилка при додаванні документа:",e)}))}))}))}t.addEventListener("submit",(function(e){e.preventDefault();uploadImage(n.files[0])}))}function bindModal(e,o,t){e=document.querySelector(e),o=document.querySelector(o),t=document.querySelector(t);const n=document.body;e.addEventListener("click",(e=>{e.preventDefault(),o.style.display="flex",n.classList.add("locked")})),t.addEventListener("click",(()=>{o.style.display="none",n.classList.remove("locked")})),o.addEventListener("click",(e=>{e.target===o&&(o.style.display="none",n.classList.remove("locked"))}))}bindModal(".modal__btn",".modal__wrapper",".modal__close");let searchBox=document.querySelector(".header__box"),modalLogin=document.querySelector(".modal__wrapper"),userEnter=document.querySelector(".header__user"),loginBox=document.querySelector(".header__login-box");function submitForm(){let e=document.getElementById("loginForm").elements.email.value,o=document.getElementById("loginForm").elements.password.value;firebase.auth().signInWithEmailAndPassword(e,o).then((e=>{let o=e.user;firebase.firestore().collection("users").doc(o.uid).get().then((e=>{if(e.exists){const t=e.data().role;localStorage.setItem("userRole",t),localStorage.setItem("userId",o.uid),localStorage.setItem("userEmail",o.email),localStorage.setItem("userName",e.data().firstName),searchBox.classList.add("show"),modalLogin.classList.add("hide"),userEnter.classList.add("hide"),loginBox.classList.add("show-box"),console.log(t),console.log("Успішний вхід:",o)}else console.error("Документ користувача не існує!")}))})).catch((e=>{var o=e.code,t=e.message;console.error("Помилка входу:",o,t)}))}function logOut(){localStorage.removeItem("userId"),localStorage.removeItem("userEmail"),localStorage.removeItem("userRole"),localStorage.removeItem("userName"),searchBox.classList.remove("show"),modalLogin.classList.remove("hide"),userEnter.classList.remove("hide"),loginBox.classList.remove("show-box"),console.log("Користувач вийшов."),window.location.href="/index.html"}async function checkIfUserIsAdmin(e){if(!e){return"admin"===localStorage.getItem("userRole")}try{const o=firebase.firestore().collection("users").doc(e.uid),t=await o.get();if(t.exists){return"admin"===t.data().role}return console.error("Документ користувача не існує!"),!1}catch(e){return console.error("Помилка при отриманні ролі користувача:",e),!1}}document.addEventListener("DOMContentLoaded",(async function(){const e=document.getElementById("filmCollection");firebase.auth().onAuthStateChanged((async function(o){if(o){await checkIfUserIsAdmin(o);if(e)try{(await firebase.firestore().collection("films").get()).forEach((e=>{const o=e.data();console.log(o.authorUid)}))}catch(e){console.error("Помилка при отриманні фільмів з Firebase:",e)}}else window.location.pathname.includes("index.html")||(console.log("Направляю неавторизованого користувача на index.html"),window.location.href="index.html")}))}));let userId=localStorage.getItem("userId"),userEmail=localStorage.getItem("userEmail");userId&&userEmail?(searchBox.classList.add("show"),modalLogin.classList.add("hide"),userEnter.classList.add("hide"),loginBox.classList.add("show-box"),console.log("Користувач увійшов. ID:",userId,"Email:",userEmail)):window.location.pathname.includes("index.html")?console.log("Користувач не увійшов. Покажіть стандартний інтерфейс або виконайте інші дії."):(console.log("Направляю неавторизованого користувача на index.html"),window.location.href="/index.html"),"Інформація про фільм"===document.title&&document.addEventListener("DOMContentLoaded",(function(){const e=new URLSearchParams(window.location.search),o=String(e.get("id")),t=document.getElementById("moviePoster"),n=document.getElementById("movieTrailer"),l=document.getElementById("releaseYearLabel"),a=document.getElementById("releaseYearValue"),c=document.getElementById("movieDescrLabel"),i=document.getElementById("movieDescrValue");console.log("movieId:",o);firebase.firestore().collection("films").doc(o).get().then((e=>{if(e.exists){const o=e.data();t.src=o.imageURL,document.getElementById("movieTitle").innerText=o.title,l.innerText="Рік виходу: ",a.innerText=o.year,c.innerText="Опис: ",i.innerText=o.description,n.src=o.youtubeURL}else console.error("No such document!")})).catch((e=>console.error("Error fetching movie details:",e)))})),document.addEventListener("DOMContentLoaded",(function(){["collection-films.html","інша-захищена-сторінка.html"].includes(window.location.pathname)&&!checkAuth()&&(console.log("Користувач не увійшов. Перенаправлення на сторінку авторизації."),window.location.href="/index.html")}));